<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Interview Checklist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .score-card, .questions-card {
            transition: all 0.2s ease-in-out;
        }
        #questions-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 md:p-8">
    <div class="max-w-4xl mx-auto">
        
        <!-- Header Section -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">English Comprehension: Interactive Checklist</h1>
            <p class="text-gray-600 mt-2">Fill out the form, then download the results as a PDF file to save them.</p>
        </div>

        <!-- Collapsible Questions Section -->
        <div class="questions-card bg-white rounded-xl shadow-md mb-8">
            <button id="questions-toggle" class="w-full flex justify-between items-center p-6 text-left">
                <span class="text-xl font-bold text-gray-800">Interview Questions</span>
                <svg id="questions-chevron" class="w-6 h-6 transform transition-transform" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
            </button>
            <div id="questions-content" class="px-6">
                <div class="pb-6 space-y-4 text-gray-700 border-t pt-4">
                    <div>
                        <h4 class="font-semibold">Part 1: Introduction & Warm-Up</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li><strong>Q1: "Good morning/afternoon. Can you please introduce yourself?"</strong><br><small class="text-gray-500">Expected: State name, age, previous school.</small></li>
                            <li><strong>Q2: "Tell me a little about your junior high school. What was it like?"</strong><br><small class="text-gray-500">Expected: Simple description of the school, teachers, or friends.</small></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold">Part 2: Expressing Opinions & Preferences</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li><strong>Q3: "What is your favorite subject in school, and why do you enjoy it?"</strong><br><small class="text-gray-500">Expected: Name a subject and give a reason.</small></li>
                            <li><strong>Q4: "What do you like to do in your free time?"</strong><br><small class="text-gray-500">Expected: Describe one or two hobbies or activities.</small></li>
                        </ul>
                    </div>
                     <div>
                        <h4 class="font-semibold">Part 3: Scenario Comprehension</h4>
                         <p class="mt-1 italic">Read aloud: "Our school encourages all students to develop a new skill. Every semester, students can choose to join one club, for example, the music club, the sports club, or the science club. Students must choose their club in the first week of the school year."</p>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                            <li><strong>Q5a: "Based on what I just said, what must students choose in the first week?"</strong><br><small class="text-gray-500">Expected: "A club."</small></li>
                            <li><strong>Q5b: "Can you name one example of a club that was mentioned?"</strong><br><small class="text-gray-500">Expected: "Music club," "sports club," or "science club."</small></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold">Part 4: Future Plans & Aspirations</h4>
                        <ul class="list-disc list-inside mt-2 space-y-1">
                             <li><strong>Q6: "Why are you interested in studying at our senior high school?"</strong><br><small class="text-gray-500">Expected: A reason related to the school's reputation, programs, or personal goals.</small></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Student Details Form -->
        <form id="student-details-form" class="bg-white p-6 rounded-xl shadow-md mb-8 grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label for="student-name" class="block text-sm font-medium text-gray-700">Student's Name</label>
                <input type="text" id="student-name" name="student-name" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <div>
                <label for="interview-date" class="block text-sm font-medium text-gray-700">Interview Date</label>
                <input type="date" id="interview-date" name="interview-date" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
        </form>

        <!-- Assessment Form -->
        <form id="assessment-form">
            <div class="space-y-6">
                <!-- Assessment Criteria Items will be dynamically inserted here -->
            </div>
            
            <!-- Results Section -->
            <div id="results-section" class="mt-8 p-6 bg-white rounded-xl shadow-md sticky bottom-4 border-t-4 border-indigo-500">
                <div class="flex flex-col sm:flex-row justify-between items-center">
                    <div class="text-center sm:text-left mb-4 sm:mb-0">
                        <h2 class="text-xl font-bold text-gray-800">Overall Assessment</h2>
                        <p id="recommendation-text" class="text-lg font-medium text-indigo-600 mt-1">Awaiting responses...</p>
                    </div>
                    <div class="text-center">
                        <div class="text-gray-600 text-sm font-medium">TOTAL SCORE</div>
                        <div id="total-score" class="text-4xl font-bold text-gray-800">0 <span class="text-2xl text-gray-500">/ 100</span></div>
                    </div>
                </div>
            </div>

             <!-- Notes and Action Buttons -->
            <div class="mt-8 bg-white p-6 rounded-xl shadow-md">
                 <label for="comments" class="block text-sm font-medium text-gray-700 mb-2">General Comments & Strengths/Weaknesses</label>
                 <textarea id="comments" name="comments" rows="4" class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" placeholder="e.g., 'Very confident but struggles with past tense'"></textarea>
                 <div class="mt-4 flex flex-col sm:flex-row gap-2">
                    <button type="button" id="download-pdf-button" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 w-full sm:w-auto flex-grow">
                        Download as PDF
                    </button>
                    <button type="button" id="reset-button" class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 w-full sm:w-auto">
                        Reset for Next Student
                    </button>
                </div>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DATA ---
            const criteria = [
                { id: 'introduction', title: 'Part 1: Introduction', description: 'Answers questions about self and past experiences (Q1, Q2).' },
                { id: 'opinions', title: 'Part 2: Expressing Opinions', description: 'States a preference and provides a logical reason or justification (Q3, Q4).' },
                { id: 'comprehension', title: 'Part 3: Listening Comprehension', description: 'Accurately recalls specific details from a spoken text (Q5a, Q5b).' },
                { id: 'future_plans', title: 'Part 4: Future Plans', description: 'Clearly expresses personal goals or reasons for applying to the school (Q6).' },
                { id: 'vocabulary', title: 'Vocabulary', description: 'Uses a sufficient range of words to convey ideas without major repetition.' },
                { id: 'fluency', title: 'Fluency & Confidence', description: 'Speaks at a reasonable pace with natural, though not necessarily perfect, flow.' },
                { id: 'clarity', title: 'Pronunciation & Clarity', description: 'Speech is generally understandable, despite any accent or minor mispronunciations.' }
            ];

            const scoreDescriptions = {
                1: '<strong>Needs Improvement:</strong> Struggles to understand, response is irrelevant or requires prompting.',
                2: '<strong>Satisfactory:</strong> Understands and gives a basic answer, but with hesitation or errors.',
                3: '<strong>Good:</strong> Understands easily and responds confidently with clear, coherent answers.'
            };

            const formContainer = document.querySelector('#assessment-form .space-y-6');

            // --- RENDER CRITERIA ---
            criteria.forEach(item => {
                const card = document.createElement('div');
                card.className = 'score-card bg-white p-6 rounded-xl shadow-md';
                card.innerHTML = `
                    <div class="flex flex-col md:flex-row justify-between md:items-center">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">${item.title}</h3>
                            <p class="text-gray-600 mt-1">${item.description}</p>
                        </div>
                        <fieldset class="mt-4 md:mt-0 flex space-x-4" id="${item.id}-fieldset">
                            <legend class="sr-only">Score for ${item.title}</legend>
                            ${[1, 2, 3].map(score => `
                                <div class="flex items-center">
                                    <input id="${item.id}-${score}" name="${item.id}" type="radio" value="${score}" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                    <label for="${item.id}-${score}" class="ml-2 block text-sm font-medium text-gray-700">${score}</label>
                                </div>
                            `).join('')}
                        </fieldset>
                    </div>
                    <div id="${item.id}-feedback" class="mt-3 text-sm text-gray-500 h-12"></div>
                `;
                formContainer.appendChild(card);
            });

            const assessmentForm = document.getElementById('assessment-form');
            const detailsForm = document.getElementById('student-details-form');
            const totalScoreEl = document.getElementById('total-score');
            const recommendationEl = document.getElementById('recommendation-text');
            const resetButton = document.getElementById('reset-button');
            const downloadButton = document.getElementById('download-pdf-button');
            const questionsToggle = document.getElementById('questions-toggle');
            const questionsContent = document.getElementById('questions-content');
            const questionsChevron = document.getElementById('questions-chevron');

            let currentPercentageScore = 0;
            let currentRecommendation = 'Awaiting responses...';

            // --- UI LOGIC ---
            function updateScore() {
                const formData = new FormData(assessmentForm);
                let rawScore = 0;
                let criteriaCount = 0;
                for (let value of formData.values()) {
                    rawScore += parseInt(value, 10);
                    criteriaCount++;
                }
                
                const maxRawScore = criteria.length * 3;
                let percentageScore = 0;
                if (criteriaCount > 0) {
                   percentageScore = Math.round((rawScore / maxRawScore) * 100);
                }
                currentPercentageScore = percentageScore;

                totalScoreEl.innerHTML = `${percentageScore} <span class="text-2xl text-gray-500">/ 100</span>`;
                
                let recommendation = '';
                let recommendationColor = '';
                if (percentageScore >= 86) {
                    recommendation = 'Excellent Candidate. Recommended.';
                    recommendationColor = 'text-green-600';
                } else if (percentageScore >= 62) {
                    recommendation = 'Good Candidate. Recommended.';
                    recommendationColor = 'text-blue-600';
                } else if (percentageScore >= 38) {
                    recommendation = 'Potential Candidate. Recommend with support.';
                    recommendationColor = 'text-yellow-600';
                } else if (criteriaCount > 0) {
                    recommendation = 'High-Need Candidate. Not recommended.';
                    recommendationColor = 'text-red-600';
                } else {
                    recommendation = 'Awaiting responses...';
                    recommendationColor = 'text-indigo-600';
                }
                
                currentRecommendation = recommendation;
                recommendationEl.textContent = recommendation;
                recommendationEl.className = `text-lg font-medium transition-colors duration-300 ${recommendationColor}`;
            }

            function updateFeedback(event) {
                const fieldset = event.target.closest('fieldset');
                if (!fieldset) return;
                const feedbackEl = document.getElementById(`${fieldset.id.replace('-fieldset', '')}-feedback`);
                const score = event.target.value;
                if (feedbackEl && scoreDescriptions[score]) {
                    feedbackEl.innerHTML = scoreDescriptions[score];
                }
            }
            
            // --- PDF DOWNLOAD LOGIC ---
            function downloadPDF() {
                const { jsPDF } = window.jspdf;
                const studentName = document.getElementById('student-name').value || 'Unnamed_Student';
                const interviewDate = document.getElementById('interview-date').value;
                const comments = document.getElementById('comments').value;

                const pdfContainer = document.createElement('div');
                pdfContainer.id = 'pdf-content';
                pdfContainer.style.position = 'absolute';
                pdfContainer.style.left = '-9999px';

                let reportHTML = `
                    <div style="border-bottom: 2px solid #e5e7eb; padding-bottom: 16px;">
                        <h1 style="font-size: 2.25rem; font-weight: 700;">Assessment Report</h1>
                        <p style="font-size: 1.125rem; color: #4b5563;">English Comprehension Interview</p>
                    </div>
                    <div style="margin-top: 32px; display: flex; justify-content: space-between;">
                        <div><p style="font-weight: 600;">Student Name:</p><p>${studentName}</p></div>
                        <div><p style="font-weight: 600;">Interview Date:</p><p>${interviewDate}</p></div>
                    </div>
                    <h2 style="margin-top: 32px; font-size: 1.5rem; font-weight: 600; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">Detailed Scores</h2>
                    <table style="width: 100%; margin-top: 16px; border-collapse: collapse;">
                        <thead><tr style="text-align: left; background-color: #f3f4f6;"><th style="padding: 12px; border: 1px solid #e5e7eb;">Criterion</th><th style="padding: 12px; border: 1px solid #e5e7eb;">Score (1-3)</th></tr></thead><tbody>`;
                
                const scores = new FormData(assessmentForm);
                criteria.forEach(c => {
                    const score = scores.get(c.id) || 'N/A';
                    reportHTML += `<tr><td style="padding: 12px; border: 1px solid #e5e7eb;">${c.title}</td><td style="padding: 12px; border: 1px solid #e5e7eb;">${score}</td></tr>`;
                });

                reportHTML += `</tbody></table>
                    <div style="margin-top: 32px; display: flex; justify-content: space-between; align-items: flex-end; padding: 24px; background-color: #f9fafb; border-radius: 8px;">
                        <div><h2 style="font-size: 1.5rem; font-weight: 600;">Final Result</h2><p style="font-size: 1.125rem; font-weight: 500; color: #4f46e5;">${currentRecommendation}</p></div>
                        <div style="text-align: right;"><p style="font-size: 1rem; color: #4b5563;">TOTAL SCORE</p><p style="font-size: 2.5rem; font-weight: 700;">${currentPercentageScore} / 100</p></div>
                    </div>
                    <div style="margin-top: 32px;"><h3 style="font-size: 1.25rem; font-weight: 600;">Comments</h3><p style="border: 1px solid #e5e7eb; padding: 12px; border-radius: 8px; margin-top: 8px; min-height: 80px;">${comments || 'No comments.'}</p></div>`;

                pdfContainer.innerHTML = reportHTML;
                document.body.appendChild(pdfContainer);

                html2canvas(pdfContainer, { scale: 2 }).then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const pdfWidth = pdf.internal.pageSize.getWidth();
                    const imgWidth = pdfWidth;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                    pdf.save(`${studentName.replace(/ /g,"_")}_Assessment.pdf`);
                    document.body.removeChild(pdfContainer);
                });
            }

            // --- EVENT LISTENERS ---
            assessmentForm.addEventListener('change', (event) => {
                updateScore();
                updateFeedback(event);
            });

            resetButton.addEventListener('click', function() {
                detailsForm.reset();
                assessmentForm.reset();
                document.getElementById('comments').value = '';
                document.querySelectorAll('[id$="-feedback"]').forEach(el => el.innerHTML = '');
                updateScore();
                document.getElementById('interview-date').value = new Date().toISOString().split('T')[0];
            });

            questionsToggle.addEventListener('click', () => {
                if (questionsContent.style.maxHeight) {
                    questionsContent.style.maxHeight = null;
                    questionsChevron.classList.remove('rotate-180');
                } else {
                    questionsContent.style.maxHeight = questionsContent.scrollHeight + "px";
                    questionsChevron.classList.add('rotate-180');
                }
            });

            downloadButton.addEventListener('click', downloadPDF);

            // Set initial date
            document.getElementById('interview-date').value = new Date().toISOString().split('T')[0];
        });
    </script>
</body>
</html>

